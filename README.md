# Test of expression tree speed

The tests the speed of various dynamic execution methods using C#
reflection and compiled expressions.  The desired use case of this
sort of dynamic execution is for an application that performs computation
based off of directed acyclic graph.  More specifically, in a
[node graph architecture](https://en.wikipedia.org/wiki/Node_graph_architecture) application.

## Benchmarks

There are 4 benchmarks.  The baseline computation is

        for (int i = 0; i < opcount; ++i)
        {
            DoNothingUsefulFunction(1);
        }

Where opcount is a constant currently defined as 10000.  This is to
represent calling 10000 methods as a nominal representation of work.
In the node graph application, an executor is generated that 
executes many functions in this way configured dynamically (with additional
data management not shown).

### Individual Benchmarks
* DirectCall - This is a duplicate if what is written above if the loop were typed and compiled directly.
* ReflectionCall - This uses reflection to Invoke the function through MethodInfo (typical reflection dynamic calls).
* CompiledLoopingExpression - Compiled version of an expression that generates the for loop with function call using Expressions.
* FastCompiledLoopingExpression - Same as CompiledLoopingExpression except the final compilation stage uses the [FastExpressionCompiler](https://github.com/dadhi/FastExpressionCompiler) library.
* InterpretedExpression - Built with Expression, except Compile was called to prefer interpretation.

# Results

|                        Method |       Mean |     Error |     StdDev |     Median |
|------------------------------ |-----------:|----------:|-----------:|-----------:|
|                    DirectCall |   1.589 ns | 0.0211 ns |  0.0197 ns |   1.587 ns |
|                ReflectionCall | 157.486 ns | 6.1812 ns | 18.2255 ns | 152.634 ns |
|     CompiledLoopingExpression |   1.463 ns | 0.0287 ns |  0.0429 ns |   1.449 ns |
| FastCompiledLoopingExpression |   1.421 ns | 0.0156 ns |  0.0130 ns |   1.415 ns |
|         InterpretedExpression | 113.315 ns | 4.1291 ns | 12.1100 ns | 112.769 ns |

## Result Narriative
Performing 10000 MethodInfo.Invoke calls is **92 times slower** than a compiled version.  Important though, is that the code
generated by the expression compiler is
equivalent to natively compiled code.  This is expected because
it should be generating nearly identical IL code which is
optimized with JIT.  This benchmark simply confirms that fact.